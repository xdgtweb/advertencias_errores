<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flugpaten Debug Checklist</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            padding: 0;
            margin: 0;
        }

        #checklist-container {
            padding: 20px;
            max-width: 800px;
            margin: 40px auto;
            background-color: #46244C;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        h1 {
            color: #fff;
            text-align: center;
            margin-bottom: 20px;
        }

        .progress-bar-area {
            padding: 10px;
            background-color: #712B75;
            color: #fff;
            border-radius: 4px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #clear-button {
            padding: 8px 12px;
            background-color: #ac6f82;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        #checklist {
            border-top: 1px solid #ac6f82;
            padding-top: 10px;
        }

        .check-item {
            margin-bottom: 15px;
            padding: 12px;
            border: 1px solid #712B75;
            border-radius: 6px;
            background-color: #f8f9fa;
            transition: all 0.3s;
        }

        .check-item.completed {
            background-color: #d4edda;
            opacity: 0.9;
        }

        .check-label {
            display: flex;
            align-items: flex-start;
            cursor: pointer;
            color: #000;
        }

        .check-input {
            margin-right: 10px;
            min-width: 20px;
            min-height: 20px;
            accent-color: #46244C;
        }

        .check-content {
            flex-grow: 1;
        }

        .description {
            margin: 0;
            font-weight: 600;
            
        }

        .file {
            display: block;
            font-size: 11px;
            margin-top: 5px;
            color: #333;
        }

        .description.completed {
            text-decoration: line-through;
        }
    </style>
</head>
<body>

    <div id="checklist-container">
        <h1>Flugpaten Debug Checklist</h1>
        
        <div class="progress-bar-area">
            <span id="progress-text">Progreso: 0 de 0 completados (0%)</span>
            <button id="clear-button">Reiniciar Checklist</button>
        </div>

        <div id="checklist">
            <!-- Items se insertarán aquí por JavaScript -->
        </div>
    </div>

    <script>
        const DEBUG_STEPS = [
            // --- Back-end (Resolviendo Errores 500/JSON) ---
            { id: 'b1', description: 'Añadir método `rutesSenseAdmin` en RolController para obtener roles excluyendo al Admin, implementando `try/catch` para prevenir fallos 500 al llamar a la DB.', file: 'Backend: app/Http/Controllers/RolController.php' },
            { id: 'b2', description: 'Definir la ruta `GET roles/rutesSenseAdmin` en `routes/api.php` de forma estática y antes de la ruta dinámica `/roles/{nom}`.', file: 'Backend: routes/api.php' },
            
            // --- Warnings React Core y Naming Convention ---
            { id: 'r1', description: 'Corregir anidamiento `ul > a`: En los 3 Sidebars, envolver los `<a>` dentro de etiquetas `<li>` para respetar la estructura HTML (`ul > li > a`).', file: 'NavbarLoginAdmin/sidebar.js, NavbarLoginProtectora/sidebarProtectora.js, NavbarLoginVeterinari/SidebarVeterinari.js' },
            { id: 'r2', description: 'Evitar GET 404 al inicio: Retirar la llamada inicial `this.checkEmail()` de `componentDidMount` en la página de Registro.', file: 'Registrarse/index.js (Línea 69 aproximadamente)' },
            { id: 'r3', description: 'Corregir error de prop "select": En `<FormSelect>`, usar solo la prop `value={this.state...}` y eliminar `defaultValue` si existe.', file: 'Registrarse/index.js, EditaCiutat.js' },
            
            // --- Styled Components / DOM Warnings ---
            { id: 'r4', description: 'Corregir advertencias de props: En `<ButtonSlider>`, pasar props como `primary`, `dark`, `big` como valores numéricos (1 ó 0) en lugar de booleanos directos (`true`/`false`) para evitar warnings en el DOM.', file: 'SliderSection/index.js y InfoSection/index.js' },
            { id: 'r5', description: 'Corregir Casing: Cambiar la definición de función `dataFetching` a `DataFetching` (PascalCase).', file: 'Fetch/DataFetching.js' },
        ];

        const STORAGE_KEY = 'vanillaErrorCheckList';
        const checklistDiv = document.getElementById('checklist');
        const progressText = document.getElementById('progress-text');
        const clearButton = document.getElementById('clear-button');

        let checkedItems = {};

        function loadProgress() {
            const storedItems = localStorage.getItem(STORAGE_KEY);
            if (storedItems) {
                try {
                    checkedItems = JSON.parse(storedItems);
                } catch (e) {
                    // Limpiar si el formato JSON es incorrecto
                    localStorage.removeItem(STORAGE_KEY);
                }
            }
        }

        function saveProgress() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(checkedItems));
            renderProgress();
        }

        function renderChecklist() {
            checklistDiv.innerHTML = ''; // Limpiar lista
            
            DEBUG_STEPS.forEach(step => {
                const isChecked = checkedItems[step.id] || false;
                
                const itemDiv = document.createElement('div');
                itemDiv.className = `check-item ${isChecked ? 'completed' : ''}`;
                
                itemDiv.innerHTML = `
                    <label class="check-label">
                        <input type="checkbox" class="check-input" data-id="${step.id}" ${isChecked ? 'checked' : ''}>
                        <div class="check-content">
                            <p class="description ${isChecked ? 'completed' : ''}">${step.description}</p>
                            <code class="file">Archivos: ${step.file}</code>
                        </div>
                    </label>
                `;
                
                // Añadir el manejador de eventos (más eficiente que ponerlo en el innerHTML)
                const checkbox = itemDiv.querySelector('input[type="checkbox"]');
                checkbox.addEventListener('change', (e) => {
                    handleCheck(step.id, e.target.checked);
                });
                
                checklistDiv.appendChild(itemDiv);
            });
            renderProgress();
        }

        function handleCheck(id, checked) {
            checkedItems[id] = checked;
            saveProgress();
            
            // Re-renderizar un solo item para la retroalimentación visual instantánea
            const itemElement = checklistDiv.querySelector(`.check-item:has(input[data-id="${id}"])`);
            if (itemElement) {
                itemElement.classList.toggle('completed', checked);
                itemElement.querySelector('.description').classList.toggle('completed', checked);
            }
        }

        function renderProgress() {
            const completedCount = Object.values(checkedItems).filter(Boolean).length;
            const totalCount = DEBUG_STEPS.length;
            const percentage = totalCount > 0 ? Math.round((completedCount / totalCount) * 100) : 0;
            
            progressText.textContent = `Progreso: ${completedCount} de ${totalCount} completados (${percentage}%)`;
        }

        function handleClearAll() {
            if (confirm("¿Seguro que quieres borrar todo el progreso de la lista?")) {
                localStorage.removeItem(STORAGE_KEY);
                checkedItems = {};
                renderChecklist(); 
                renderProgress();
            }
        }

        // Inicialización
        loadProgress();
        renderChecklist();

        // Event listener para el botón de Reiniciar
        clearButton.addEventListener('click', handleClearAll);

    </script>

</body>
</html>
